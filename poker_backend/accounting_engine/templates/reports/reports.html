{% extends 'users/base.html' %} {% load crispy_forms_tags %}{% block title %}
Reports {% endblock %} {% block script %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tables = document.querySelectorAll("table");
    tables.forEach((table) => {
      const row_nets = table.getElementsByClassName("net");
      var sum = 0;
      for (var i = 0; i < row_nets.length; i++) {
        sum += parseInt(row_nets[i].innerHTML);
      }
      const row = table.insertRow();
      for (var i = 0; i < table.rows[0].cells.length; i++) {
        row.insertCell(i);
      }
      const cell_total = row.insertCell(5);
      const cell_sum = row.insertCell(6);
      cell_total.innerHTML = "<h4><strong>Total</strong><h4>";
      cell_sum.innerHTML = `<h4><strong>${sum}</strong><h4>`;
    });
  });
</script>
{%endblock%} {% block style %}
<style></style>
{% endblock %} {% block body %}
<h3>Reports</h3>
<div class="row">
  <div class="col-md-4">
    <form id="report_form" action="{% url 'reports' %}" method="POST">
      {% csrf_token %} {{ form|crispy }}
      <input
        type="submit"
        class="btn btn-primary btn-block"
        value="Get Report"
      />
    </form>
  </div>
  {% if user_earnings %}
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">Statement</div>
      <div class="card-body">Total Earnings: RM{{ user_earnings}}</div>
    </div>
  </div>
  {% endif %}
</div>
<hr />

<div>
  {% for agent, reports in reports.items %}
  <h3>{{ agent }}</h3>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Club</th>
        <th>Account</th>
        <th>WinLoss</th>
        <th>Rake</th>
        <th>Rakeback</th>
        <th>Total NET</th>
        <th>MYR</th>
      </tr>
    </thead>
    <tbody>
      {% for report in reports %}
      <tr>
        <td>{{ report.club}}</td>
        <td>{{report.account}}</td>
        <td>{{ report.gross_winloss}}</td>
        <td>{{ report.total_rake}}</td>
        <td>{{ report.rakeback }}</td>
        <td>{{ report.net_winloss}}</td>
        <td><span class="net">{{ report.net_winloss_fiat}}</span></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endfor %}
</div>
{% endblock %}
