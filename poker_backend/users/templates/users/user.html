{% extends "users/base.html" %} {% block title %} {{ user }} {% endblock %}
{%block script%} 
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('.hidden_div').forEach((div) => {
    div.querySelector('.untoggle_button').onclick = () => {
      const accounts = div.querySelector('.toggle_div')
      if (accounts.style.display === 'none') {
        accounts.style.display = "block";
      }else{
        accounts.style.display = "none";
      }
    }
  })


})


</script>
{%endblock%} 
{% load crispy_forms_tags %} 
{% block style %}
<style>
ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.hidden_div {
  padding: 2px;
}

h3 {
  text-align: center;
}

</style>
{% endblock %}


{%block body%}
<div>
  <p class='display-4'>Welcome {{ user.username}}</p>
</div>
<div>
  <h3>Clubs</h3>
  <table class="table">
    <thead>
      <tr>
        <th>Platform</th>
        <th>Name</th>
        <th>Code</th>
        <th>Club ID</th>
        <th>MYR</th>
      </tr>
    </thead>
    <tbody>
      {% for club in clubs %}
      <tr>
        <td>{{ club.platform}}</td>
        <td>{{ club.name }}</td>
        <td>{{ club.code }}</td>
        <td>{{ club.club_id }}</td>
        <td>{{ club.chip_value }}</td>
      </tr>
      {% endfor %}
    </tbody>

    </tr>
  </table>
</div>

<div class='row'>
  <div class='col-md-6'>
    <div>
      <h3>Agent Players</h3>
      <ul>
        {% for agent in user.agent_players.all %}
        <li>
          <div class="hidden_div">
            <button class="untoggle_button btn btn-primary btn-block">{{ agent }}</button>
            <div class='toggle_div' style="display: none">
              <strong>Accounts</strong>
              <ul>
                {% for account in agent.accounts.all %}
                <li>{{ account }}</li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class='col-md-6'>
    <h3>Action</h3>
    <div class="hidden_div">
      <button class="untoggle_button btn btn-secondary btn-block">Upload Report</button>
      <div class='toggle_div' style="display: none">
        <form id="file_upload_form" action="{% url 'upload_file' %}" method="POST" enctype="multipart/form-data" >
          {% csrf_token %}
          {{upload_form|crispy}}
          <input type="submit" class="btn btn-primary" value="Upload">
        </form>
      </div>
    </div>

    <div class="hidden_div">
      <button class="untoggle_button btn btn-secondary btn-block">Add New Agent/Player</button>
      <div class='toggle_div' style="display: none">
        <form id="create_agent_form" action="{% url 'create_agent' %}" method="POST">
          {% csrf_token %} {{ agent_form|crispy }}
          <input type="hidden" name="next" value="{{ request.path }}" />
          <input type="submit" class="btn btn-primary btn-block" value="Add" />
        </form>
      </div>
    </div>

    <div class="hidden_div">
      <button class="untoggle_button btn btn-secondary btn-block">Add New Account</button>
      <div class='toggle_div' style="display: none">
        <form id="create_account_form" action="{% url 'create_account' %}" method="POST">
          {% csrf_token %} {{ account_form|crispy }}
          <input type="hidden" name="next" value="{{ request.path }}" />
          <input type="submit" class="btn btn-primary btn-block" value="Add Account" />
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
